<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LeerKids | Menú de pantallas</title>
    <!-- Tailwind por CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="color-scheme" content="light dark" />
    <style>
      html,
      body {
        height: 100%;
      }
      /* Suaviza el scroll horizontal del tab bar en móviles */
      .tabs-scroll::-webkit-scrollbar {
        height: 6px;
      }
      .tabs-scroll::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
        border-radius: 9999px;
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100"
  >
    <div class="min-h-screen flex flex-col">
      <!-- Header -->
      <header
        class="border-b border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-950/60 backdrop-blur"
      >
        <div
          class="mx-auto flex items-center justify-end max-w-6xl px-2 py-3 md:hidden"
        >
          <button
            id="menuToggle"
            type="button"
            class="inline-flex items-center gap-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-white/90 dark:bg-slate-900/60 px-3 py-2 text-sm font-semibold text-slate-700 dark:text-slate-200 shadow-sm"
            aria-controls="tabBar"
            aria-expanded="false"
          >
            <span>Menu</span>
            <svg
              class="h-5 w-5 text-slate-600 dark:text-slate-300"
              viewBox="0 0 20 20"
              fill="none"
              aria-hidden="true"
            >
              <path
                d="M3 6h14M3 10h14M3 14h14"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
              />
            </svg>
          </button>
        </div>
        <!-- Tabs -->
        <nav
          id="tabBar"
          class="tabs-scroll mx-auto mt-1 max-w-6xl px-2 pb-2 overflow-x-auto hidden md:block md:mt-3"
          data-open="false"
        >
          <!-- Botones se inyectan por JS -->
        </nav>
      </header>

      <!-- Contenido -->
      <main class="flex-1">
        <!-- Viewer: usa iframe para que cada HTML mantenga sus estilos/JS -->
        <iframe
          id="viewer"
          title="Contenido"
          7
          class="w-full h-full min-h-[calc(100vh-120px)] border-0 bg-white dark:bg-slate-950"
          loading="lazy"
          referrerpolicy="no-referrer"
        >
        </iframe>
      </main>

      <!-- Footer mini -->
      <footer
        class="border-t border-slate-200 dark:border-slate-800 text-center text-xs py-4"
      >
        <span class="text-slate-500">© <span id="year"></span> Stapy</span>
      </footer>
    </div>

    <script>
      /**
       * === Cómo añadir más pestañas ===
       * 1) Agrega un objeto al arreglo TABS con: id, title, url (archivo .html).
       * 2) No necesitas tocar nada más.
       */
      const TABS = [
        {
          id: "leer",
          title: "LeerKids (ES)",
          url: "leer_kids_es.html",
        },
        {
          id: "ciencias",
          title: "Repaso Ciencias",
          url: "repasoCiencias.html",
        },
        {
          id: "cartillaFonetica",
          title: "Cartilla Fonetica",
          url: "cartilla_fonetica.html",
        },
        // { id: 'otra',  title: 'Mi otra pantalla',  url: 'mi_otra_pantalla.html' },
      ];

      const tabBar = document.getElementById("tabBar");
      const viewer = document.getElementById("viewer");
      const menuToggle = document.getElementById("menuToggle");
      const MOBILE_BREAKPOINT = 768;

      if (!tabBar.dataset.open) {
        tabBar.dataset.open = "false";
      }

      function isMobileViewport() {
        return window.innerWidth < MOBILE_BREAKPOINT;
      }

      function enforceMenuVisibility() {
        if (!isMobileViewport()) {
          tabBar.classList.remove("hidden");
          if (menuToggle) {
            menuToggle.setAttribute("aria-expanded", "true");
          }
          return;
        }
        const isOpen = tabBar.dataset.open === "true";
        tabBar.classList.toggle("hidden", !isOpen);
        if (menuToggle) {
          menuToggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
        }
      }

      function setMenuState(open) {
        tabBar.dataset.open = open ? "true" : "false";
        enforceMenuVisibility();
      }

      if (menuToggle) {
        menuToggle.addEventListener("click", () => {
          const isOpen = tabBar.dataset.open === "true";
          setMenuState(!isOpen);
        });
      }

      // Año actual para copyright
      document.getElementById("year").textContent = new Date().getFullYear();

      // Persistir última pestaña
      const LS_KEY = "index-tabs:last";

      function renderTabs(activeId) {
        tabBar.innerHTML = "";
        TABS.forEach((t) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.setAttribute("data-id", t.id);
          btn.className = [
            "whitespace-nowrap",
            "px-4 py-2 rounded-xl text-sm font-semibold",
            "transition-colors",
            "mr-2 mb-2 border",
            t.id === activeId
              ? "bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-700 text-slate-900 dark:text-slate-100 shadow"
              : "bg-slate-100/70 dark:bg-slate-800/60 border-transparent text-slate-600 dark:text-slate-300 hover:bg-white hover:text-slate-900 dark:hover:bg-slate-700",
          ].join(" ");
          btn.textContent = t.title;
          btn.addEventListener("click", () => activateTab(t.id));
          tabBar.appendChild(btn);
        });
      }

      function activateTab(id) {
        const tab = TABS.find((x) => x.id === id) || TABS[0];
        if (!tab) return;
        // Carga en iframe
        viewer.src = tab.url;
        // Marca activa
        renderTabs(tab.id);
        // Guarda estado
        try {
          localStorage.setItem(LS_KEY, tab.id);
        } catch {}
        // Actualiza hash sin hacer scroll
        if (location.hash !== "#" + tab.id) {
          history.replaceState(null, "", "#" + tab.id);
        }
        if (isMobileViewport()) {
          setMenuState(false);
        }
      }

      // Soporte para hash y localStorage
      function getInitialTabId() {
        const fromHash = (location.hash || "").replace("#", "");
        if (fromHash && TABS.some((t) => t.id === fromHash)) return fromHash;
        try {
          const last = localStorage.getItem(LS_KEY);
          if (last && TABS.some((t) => t.id === last)) return last;
        } catch {}
        return TABS[0]?.id;
      }

      // Reacciona si el usuario cambia el hash manualmente
      window.addEventListener("hashchange", () => {
        const id = (location.hash || "").replace("#", "");
        if (TABS.some((t) => t.id === id)) activateTab(id);
      });

      // Ajusta alto del iframe cuando cambia el tamaño de la ventana
      function resizeViewer() {
        // Header + tabs + footer ≈ 120px; el min-h ya cubre, pero ajustamos por si acaso
        viewer.style.height = window.innerHeight - 120 + "px";
        enforceMenuVisibility();
      }
      window.addEventListener("resize", resizeViewer);

      // Init
      renderTabs(getInitialTabId());
      activateTab(getInitialTabId());
      resizeViewer();
    </script>
  </body>
</html>
